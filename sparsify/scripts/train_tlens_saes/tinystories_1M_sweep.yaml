program: sparsify/scripts/train_tlens_saes/run_train_tlens_saes.py
name: layerwise
method: grid
metric:
  name: val_loss
  goal: minimize
parameters:
  n_samples:
    values: [400_000]
  effective_batch_size:
    values: [20]
  lr:
    values: [1e-2]
  adam_beta1:
    values: [0.9]
  lr_schedule:
    values: [cosine]
  warmup_samples:
    values: [20_000]
  max_grad_norm:
    values: [1.0]
  loss:
    parameters:
      sparsity:
        parameters:
          coeff:
            values: [3e-2, 5e-2, 8e-2]
      in_to_orig:
        values: [null]
      out_to_in:
        parameters:
          coeff:
            values: [1.0]
      logits_kl:
        values: [null]
  saes:
    parameters:
      sae_positions:
        values:
          - blocks.1.hook_resid_post
          - blocks.3.hook_resid_post
          - blocks.5.hook_resid_post
          - blocks.7.hook_resid_post
      dict_size_to_input_ratio:
        values: [50.0]

command:
- ${env}
- ${interpreter}
- ${program}
- sparsify/scripts/train_tlens_saes/tinystories_1M_layerwise.yaml